---
phase: 01-core-infrastructure-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - src/env.ts
  - .env.local
  - .env.example
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "Next.js 15 development server starts without errors"
    - "TypeScript compilation succeeds with strict mode"
    - "Environment variables validated at build time"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "next"
    - path: "src/env.ts"
      provides: "Type-safe environment variables"
      contains: "createEnv"
    - path: "next.config.ts"
      provides: "Next.js configuration with env validation"
      contains: 'import "./src/env"'
  key_links:
    - from: "next.config.ts"
      to: "src/env.ts"
      via: "import statement"
      pattern: 'import.*env'
---

<objective>
Initialize Next.js 15 project with TypeScript and type-safe environment variables using T3 Env.

Purpose: Establish the foundation for all subsequent development with proper TypeScript configuration, environment variable validation that fails at build time (not runtime), and the Next.js App Router structure.

Output: Working Next.js 15 development environment with T3 Env for type-safe environment variables.
</objective>

<execution_context>
@/Users/quentonschneider/.claude/get-shit-done/workflows/execute-plan.md
@/Users/quentonschneider/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-infrastructure-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js 15 Project with TypeScript</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    src/app/layout.tsx
    src/app/page.tsx
    .gitignore
  </files>
  <action>
Create Next.js 15 project in the current directory (which is empty except for .planning and .git).

Run: `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --no-turbo`

After creation:
1. Verify Next.js version is 15.2.3+ in package.json (critical security requirement from RESEARCH.md)
2. If version is lower, manually update: `npm install next@latest`
3. Update tsconfig.json to enable strict mode if not already enabled:
   - "strict": true
   - "noUncheckedIndexedAccess": true
4. Verify src/app directory structure exists with layout.tsx and page.tsx
5. Keep the default Tailwind CSS setup (will customize later)

Do NOT modify the default page.tsx content yet - just verify it works.
  </action>
  <verify>
    npm run build && npm run dev
    # Dev server starts on localhost:3000 without errors
  </verify>
  <done>
    Next.js 15.2.3+ project created with TypeScript strict mode, App Router with src/ directory, Tailwind CSS configured
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure T3 Env for Type-Safe Environment Variables</name>
  <files>
    src/env.ts
    next.config.ts
    .env.local
    .env.example
    package.json
  </files>
  <action>
Install T3 Env and Zod:
```bash
npm install @t3-oss/env-nextjs zod
```

Create src/env.ts with the following structure (from RESEARCH.md Pattern 3):
```typescript
import { createEnv } from "@t3-oss/env-nextjs";
import { z } from "zod";

export const env = createEnv({
  server: {
    DATABASE_URL: z.string().url(),
    CLERK_SECRET_KEY: z.string().min(1),
    CLERK_WEBHOOK_SECRET: z.string().min(1).optional(), // Optional for now
  },
  client: {
    NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY: z.string().min(1),
    NEXT_PUBLIC_CLERK_SIGN_IN_URL: z.string().default('/sign-in'),
    NEXT_PUBLIC_CLERK_SIGN_UP_URL: z.string().default('/sign-up'),
    NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL: z.string().default('/trips'),
    NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL: z.string().default('/trips'),
  },
  runtimeEnv: {
    DATABASE_URL: process.env.DATABASE_URL,
    CLERK_SECRET_KEY: process.env.CLERK_SECRET_KEY,
    CLERK_WEBHOOK_SECRET: process.env.CLERK_WEBHOOK_SECRET,
    NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY: process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY,
    NEXT_PUBLIC_CLERK_SIGN_IN_URL: process.env.NEXT_PUBLIC_CLERK_SIGN_IN_URL,
    NEXT_PUBLIC_CLERK_SIGN_UP_URL: process.env.NEXT_PUBLIC_CLERK_SIGN_UP_URL,
    NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL: process.env.NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL,
    NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL: process.env.NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL,
  },
  // Skip validation during build in CI when env vars not available
  skipValidation: !!process.env.SKIP_ENV_VALIDATION,
});
```

Update next.config.ts to import env.ts at the top (triggers validation at build time):
```typescript
import type { NextConfig } from "next";

// Validate env vars at build time
import "./src/env";

const nextConfig: NextConfig = {
  // Recommended: output standalone for Docker deployments
  // output: "standalone",
};

export default nextConfig;
```

Create .env.example with placeholder values:
```
# Database
DATABASE_URL="postgresql://user:password@localhost:5432/trip_coordinator"

# Clerk Authentication
CLERK_SECRET_KEY="sk_test_..."
CLERK_WEBHOOK_SECRET="whsec_..."
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY="pk_test_..."
NEXT_PUBLIC_CLERK_SIGN_IN_URL="/sign-in"
NEXT_PUBLIC_CLERK_SIGN_UP_URL="/sign-up"
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL="/trips"
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL="/trips"
```

Create .env.local with SKIP_ENV_VALIDATION=true for now (will be replaced when user provides real values):
```
# Temporary: Skip validation until real env vars are provided
SKIP_ENV_VALIDATION=true
```

Ensure .env.local is in .gitignore (should be by default from create-next-app).
  </action>
  <verify>
    # Build should succeed with SKIP_ENV_VALIDATION=true
    npm run build

    # Verify env.ts exports the env object
    grep -q "export const env" src/env.ts
  </verify>
  <done>
    T3 Env configured with Zod schemas for all required environment variables. Build-time validation enabled. .env.example documents required variables. .env.local created with skip flag for initial setup.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Project Directory Structure</name>
  <files>
    src/components/.gitkeep
    src/lib/utils.ts
    src/db/.gitkeep
  </files>
  <action>
Create the recommended directory structure from RESEARCH.md:

```
src/
├── app/                      # Already exists from create-next-app
├── components/               # React components
│   └── .gitkeep             # Placeholder
├── db/                       # Database layer (Plan 03)
│   └── .gitkeep             # Placeholder
└── lib/                      # Utilities
    └── utils.ts              # Shared utility functions
```

Create src/lib/utils.ts with a basic cn() utility for Tailwind class merging:
```typescript
import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

Install clsx and tailwind-merge:
```bash
npm install clsx tailwind-merge
```

Create placeholder .gitkeep files:
- src/components/.gitkeep (empty file)
- src/db/.gitkeep (empty file)
  </action>
  <verify>
    # Verify directory structure exists
    ls src/components src/db src/lib

    # Verify utils.ts has cn function
    grep -q "export function cn" src/lib/utils.ts
  </verify>
  <done>
    Project directory structure created following RESEARCH.md conventions. cn() utility available for Tailwind class composition. Placeholder directories ready for components and database layers.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds without errors
2. `npm run dev` starts development server on localhost:3000
3. src/env.ts exists and exports typed env object
4. next.config.ts imports env.ts for build-time validation
5. Directory structure matches RESEARCH.md recommendations
</verification>

<success_criteria>
- Next.js 15.2.3+ installed and running
- TypeScript strict mode enabled
- T3 Env configured with all required variable schemas
- Build succeeds (with SKIP_ENV_VALIDATION for now)
- Project structure follows RESEARCH.md conventions
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-infrastructure-authentication/01-01-SUMMARY.md`
</output>
