---
phase: 01-core-infrastructure-authentication
plan: 05
type: execute
wave: 4
depends_on: ["01-04"]
files_modified:
  - src/app/(dashboard)/trips/page.tsx
  - src/app/(dashboard)/trips/new/page.tsx
  - src/app/(dashboard)/trips/[id]/page.tsx
  - src/app/(dashboard)/trips/[id]/edit/page.tsx
  - src/components/trips/trip-card.tsx
  - src/components/trips/trip-form.tsx
  - src/components/trips/delete-trip-button.tsx
autonomous: false

must_haves:
  truths:
    - "User can see list of all their trips"
    - "User can create a new trip with name and date range"
    - "User can view individual trip details"
    - "User can edit trip details"
    - "User can delete a trip with confirmation"
  artifacts:
    - path: "src/app/(dashboard)/trips/page.tsx"
      provides: "Trip list page"
      contains: "getTripsForUser"
    - path: "src/app/(dashboard)/trips/new/page.tsx"
      provides: "Create trip page"
      contains: "TripForm"
    - path: "src/components/trips/trip-form.tsx"
      provides: "Reusable trip form component"
      contains: "use client"
    - path: "src/components/trips/trip-card.tsx"
      provides: "Trip card display component"
      min_lines: 20
  key_links:
    - from: "src/app/(dashboard)/trips/page.tsx"
      to: "src/db/queries/trips.ts"
      via: "direct query import"
      pattern: "getTripsForUser"
    - from: "src/components/trips/trip-form.tsx"
      to: "/api/trips"
      via: "fetch POST/PATCH"
      pattern: "fetch.*api/trips"
---

<objective>
Build Trip UI with list view, create form, edit form, and delete functionality.

Purpose: Complete the user-facing trip management interface. Users can view, create, edit, and delete trips through a clean UI. This fulfills TRIP-01 through TRIP-05 requirements with visual interface.

Output: Working trip management UI with Server Components for data fetching and Client Components for interactivity.
</objective>

<execution_context>
@/Users/quentonschneider/.claude/get-shit-done/workflows/execute-plan.md
@/Users/quentonschneider/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-infrastructure-authentication/01-RESEARCH.md
@.planning/phases/01-core-infrastructure-authentication/01-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Trip List and Card Components</name>
  <files>
    src/app/(dashboard)/trips/page.tsx
    src/components/trips/trip-card.tsx
  </files>
  <action>
Create the trip list page with Server Component data fetching (RESEARCH.md Pattern 2).

src/components/trips/trip-card.tsx - Display component for a single trip:
```typescript
// src/components/trips/trip-card.tsx
import Link from "next/link";
import type { Trip } from "@/db/schema";

interface TripCardProps {
  trip: Trip;
}

export function TripCard({ trip }: TripCardProps) {
  // Format dates for display
  const formatDate = (date: Date) => {
    return new Intl.DateTimeFormat("en-US", {
      month: "short",
      day: "numeric",
      year: "numeric",
    }).format(new Date(date));
  };

  const startDate = formatDate(trip.startDate);
  const endDate = formatDate(trip.endDate);

  return (
    <Link
      href={`/trips/${trip.id}`}
      className="block bg-white rounded-lg shadow hover:shadow-md transition-shadow p-6 border border-gray-100"
    >
      <h3 className="text-lg font-semibold text-gray-900 mb-2">{trip.name}</h3>

      <p className="text-sm text-gray-600 mb-3">
        {startDate} - {endDate}
      </p>

      {trip.description && (
        <p className="text-gray-500 text-sm line-clamp-2">{trip.description}</p>
      )}

      <div className="mt-4 flex items-center text-blue-600 text-sm font-medium">
        View trip
        <svg
          className="ml-1 w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M9 5l7 7-7 7"
          />
        </svg>
      </div>
    </Link>
  );
}
```

Update src/app/(dashboard)/trips/page.tsx to fetch and display trips:
```typescript
// src/app/(dashboard)/trips/page.tsx
import { auth } from "@clerk/nextjs/server";
import { redirect } from "next/navigation";
import Link from "next/link";
import { getTripsForUser } from "@/db/queries/trips";
import { TripCard } from "@/components/trips/trip-card";

export default async function TripsPage() {
  const { userId } = await auth();

  if (!userId) {
    redirect("/sign-in");
  }

  const trips = await getTripsForUser(userId);

  return (
    <div>
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-gray-900">My Trips</h2>
        <Link
          href="/trips/new"
          className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors font-medium"
        >
          New Trip
        </Link>
      </div>

      {trips.length === 0 ? (
        <div className="bg-white rounded-lg shadow p-6">
          <p className="text-gray-500 text-center py-8">
            No trips yet. Create your first trip to get started!
          </p>
        </div>
      ) : (
        <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
          {trips.map((trip) => (
            <TripCard key={trip.id} trip={trip} />
          ))}
        </div>
      )}
    </div>
  );
}
```
  </action>
  <verify>
    # Verify trip card component exists
    grep -q "export function TripCard" src/components/trips/trip-card.tsx

    # Verify trips page fetches data
    grep -q "getTripsForUser" src/app/\\(dashboard\\)/trips/page.tsx

    # Verify link to new trip page
    grep -q "/trips/new" src/app/\\(dashboard\\)/trips/page.tsx
  </verify>
  <done>
    Trip list page created with Server Component data fetching. TripCard component displays trip details with date formatting. Empty state shown when no trips exist.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Trip Form Component</name>
  <files>
    src/components/trips/trip-form.tsx
    src/app/(dashboard)/trips/new/page.tsx
  </files>
  <action>
Create a reusable Client Component form for creating and editing trips.

src/components/trips/trip-form.tsx:
```typescript
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import type { Trip } from "@/db/schema";

interface TripFormProps {
  trip?: Trip; // If provided, we're editing
  onCancel?: () => void;
}

export function TripForm({ trip, onCancel }: TripFormProps) {
  const router = useRouter();
  const isEditing = !!trip;

  // Format date for input[type="date"]
  const formatDateForInput = (date: Date | string) => {
    const d = new Date(date);
    return d.toISOString().split("T")[0];
  };

  const [name, setName] = useState(trip?.name ?? "");
  const [description, setDescription] = useState(trip?.description ?? "");
  const [startDate, setStartDate] = useState(
    trip ? formatDateForInput(trip.startDate) : ""
  );
  const [endDate, setEndDate] = useState(
    trip ? formatDateForInput(trip.endDate) : ""
  );
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSubmitting(true);
    setError(null);

    try {
      const url = isEditing ? `/api/trips/${trip.id}` : "/api/trips";
      const method = isEditing ? "PATCH" : "POST";

      const response = await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name,
          description: description || null,
          startDate: new Date(startDate).toISOString(),
          endDate: new Date(endDate).toISOString(),
        }),
      });

      if (!response.ok) {
        const data = await response.json();
        throw new Error(data.error || "Failed to save trip");
      }

      const savedTrip = await response.json();

      if (isEditing) {
        router.push(`/trips/${savedTrip.id}`);
      } else {
        router.push("/trips");
      }
      router.refresh();
    } catch (err) {
      setError(err instanceof Error ? err.message : "An error occurred");
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {error && (
        <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md">
          {error}
        </div>
      )}

      <div>
        <label
          htmlFor="name"
          className="block text-sm font-medium text-gray-700 mb-1"
        >
          Trip Name *
        </label>
        <input
          type="text"
          id="name"
          value={name}
          onChange={(e) => setName(e.target.value)}
          required
          maxLength={255}
          className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
          placeholder="Summer Vacation 2026"
        />
      </div>

      <div>
        <label
          htmlFor="description"
          className="block text-sm font-medium text-gray-700 mb-1"
        >
          Description
        </label>
        <textarea
          id="description"
          value={description}
          onChange={(e) => setDescription(e.target.value)}
          rows={3}
          maxLength={1000}
          className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
          placeholder="A brief description of your trip..."
        />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label
            htmlFor="startDate"
            className="block text-sm font-medium text-gray-700 mb-1"
          >
            Start Date *
          </label>
          <input
            type="date"
            id="startDate"
            value={startDate}
            onChange={(e) => setStartDate(e.target.value)}
            required
            className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
          />
        </div>

        <div>
          <label
            htmlFor="endDate"
            className="block text-sm font-medium text-gray-700 mb-1"
          >
            End Date *
          </label>
          <input
            type="date"
            id="endDate"
            value={endDate}
            onChange={(e) => setEndDate(e.target.value)}
            required
            min={startDate}
            className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
          />
        </div>
      </div>

      <div className="flex justify-end gap-3">
        {onCancel && (
          <button
            type="button"
            onClick={onCancel}
            className="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"
          >
            Cancel
          </button>
        )}
        <button
          type="submit"
          disabled={isSubmitting}
          className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {isSubmitting
            ? "Saving..."
            : isEditing
              ? "Save Changes"
              : "Create Trip"}
        </button>
      </div>
    </form>
  );
}
```

src/app/(dashboard)/trips/new/page.tsx:
```typescript
// src/app/(dashboard)/trips/new/page.tsx
import { auth } from "@clerk/nextjs/server";
import { redirect } from "next/navigation";
import Link from "next/link";
import { TripForm } from "@/components/trips/trip-form";

export default async function NewTripPage() {
  const { userId } = await auth();

  if (!userId) {
    redirect("/sign-in");
  }

  return (
    <div>
      <div className="mb-6">
        <Link
          href="/trips"
          className="text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1"
        >
          <svg
            className="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M15 19l-7-7 7-7"
            />
          </svg>
          Back to trips
        </Link>
      </div>

      <div className="bg-white rounded-lg shadow p-6 max-w-2xl">
        <h2 className="text-2xl font-bold text-gray-900 mb-6">
          Create New Trip
        </h2>
        <TripForm />
      </div>
    </div>
  );
}
```
  </action>
  <verify>
    # Verify form component is client component
    grep -q '"use client"' src/components/trips/trip-form.tsx

    # Verify form handles both create and edit
    grep -q "isEditing" src/components/trips/trip-form.tsx

    # Verify new trip page exists
    test -f "src/app/(dashboard)/trips/new/page.tsx" && echo "new trip page exists"
  </verify>
  <done>
    TripForm component created as reusable Client Component for create/edit operations. New trip page uses the form. Form includes validation, error handling, and loading state.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Trip Detail, Edit, and Delete Pages</name>
  <files>
    src/app/(dashboard)/trips/[id]/page.tsx
    src/app/(dashboard)/trips/[id]/edit/page.tsx
    src/components/trips/delete-trip-button.tsx
  </files>
  <action>
Create pages for viewing, editing, and deleting individual trips.

src/components/trips/delete-trip-button.tsx:
```typescript
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";

interface DeleteTripButtonProps {
  tripId: string;
  tripName: string;
}

export function DeleteTripButton({ tripId, tripName }: DeleteTripButtonProps) {
  const router = useRouter();
  const [isDeleting, setIsDeleting] = useState(false);
  const [showConfirm, setShowConfirm] = useState(false);

  const handleDelete = async () => {
    setIsDeleting(true);

    try {
      const response = await fetch(`/api/trips/${tripId}`, {
        method: "DELETE",
      });

      if (!response.ok) {
        throw new Error("Failed to delete trip");
      }

      router.push("/trips");
      router.refresh();
    } catch (error) {
      console.error("Delete failed:", error);
      alert("Failed to delete trip. Please try again.");
    } finally {
      setIsDeleting(false);
      setShowConfirm(false);
    }
  };

  if (showConfirm) {
    return (
      <div className="flex items-center gap-2">
        <span className="text-sm text-gray-600">Delete "{tripName}"?</span>
        <button
          onClick={handleDelete}
          disabled={isDeleting}
          className="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 disabled:opacity-50"
        >
          {isDeleting ? "Deleting..." : "Confirm"}
        </button>
        <button
          onClick={() => setShowConfirm(false)}
          disabled={isDeleting}
          className="px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300"
        >
          Cancel
        </button>
      </div>
    );
  }

  return (
    <button
      onClick={() => setShowConfirm(true)}
      className="text-red-600 hover:text-red-800 text-sm"
    >
      Delete
    </button>
  );
}
```

src/app/(dashboard)/trips/[id]/page.tsx:
```typescript
// src/app/(dashboard)/trips/[id]/page.tsx
import { auth } from "@clerk/nextjs/server";
import { redirect, notFound } from "next/navigation";
import Link from "next/link";
import { getTripById } from "@/db/queries/trips";
import { DeleteTripButton } from "@/components/trips/delete-trip-button";

interface TripDetailPageProps {
  params: Promise<{ id: string }>;
}

export default async function TripDetailPage({ params }: TripDetailPageProps) {
  const { userId } = await auth();
  const { id } = await params;

  if (!userId) {
    redirect("/sign-in");
  }

  const trip = await getTripById(id, userId);

  if (!trip) {
    notFound();
  }

  const formatDate = (date: Date) => {
    return new Intl.DateTimeFormat("en-US", {
      weekday: "long",
      month: "long",
      day: "numeric",
      year: "numeric",
    }).format(new Date(date));
  };

  return (
    <div>
      <div className="mb-6">
        <Link
          href="/trips"
          className="text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1"
        >
          <svg
            className="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M15 19l-7-7 7-7"
            />
          </svg>
          Back to trips
        </Link>
      </div>

      <div className="bg-white rounded-lg shadow">
        <div className="p-6 border-b border-gray-100">
          <div className="flex justify-between items-start">
            <div>
              <h1 className="text-2xl font-bold text-gray-900 mb-2">
                {trip.name}
              </h1>
              <p className="text-gray-600">
                {formatDate(trip.startDate)} - {formatDate(trip.endDate)}
              </p>
            </div>
            <div className="flex items-center gap-4">
              <Link
                href={`/trips/${trip.id}/edit`}
                className="text-blue-600 hover:text-blue-800 text-sm font-medium"
              >
                Edit
              </Link>
              <DeleteTripButton tripId={trip.id} tripName={trip.name} />
            </div>
          </div>
        </div>

        {trip.description && (
          <div className="p-6 border-b border-gray-100">
            <h2 className="text-sm font-medium text-gray-500 mb-2">
              Description
            </h2>
            <p className="text-gray-700 whitespace-pre-wrap">
              {trip.description}
            </p>
          </div>
        )}

        <div className="p-6">
          <h2 className="text-sm font-medium text-gray-500 mb-4">Events</h2>
          <p className="text-gray-400 text-center py-8">
            Events will be available in a future update.
          </p>
        </div>
      </div>
    </div>
  );
}
```

src/app/(dashboard)/trips/[id]/edit/page.tsx:
```typescript
// src/app/(dashboard)/trips/[id]/edit/page.tsx
import { auth } from "@clerk/nextjs/server";
import { redirect, notFound } from "next/navigation";
import Link from "next/link";
import { getTripById } from "@/db/queries/trips";
import { TripForm } from "@/components/trips/trip-form";

interface EditTripPageProps {
  params: Promise<{ id: string }>;
}

export default async function EditTripPage({ params }: EditTripPageProps) {
  const { userId } = await auth();
  const { id } = await params;

  if (!userId) {
    redirect("/sign-in");
  }

  const trip = await getTripById(id, userId);

  if (!trip) {
    notFound();
  }

  return (
    <div>
      <div className="mb-6">
        <Link
          href={`/trips/${trip.id}`}
          className="text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1"
        >
          <svg
            className="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M15 19l-7-7 7-7"
            />
          </svg>
          Back to trip
        </Link>
      </div>

      <div className="bg-white rounded-lg shadow p-6 max-w-2xl">
        <h2 className="text-2xl font-bold text-gray-900 mb-6">Edit Trip</h2>
        <TripForm trip={trip} />
      </div>
    </div>
  );
}
```
  </action>
  <verify>
    # Verify trip detail page exists
    test -f "src/app/(dashboard)/trips/[id]/page.tsx" && echo "detail page exists"

    # Verify edit page exists
    test -f "src/app/(dashboard)/trips/[id]/edit/page.tsx" && echo "edit page exists"

    # Verify delete button component
    grep -q "DeleteTripButton" src/components/trips/delete-trip-button.tsx

    # Build should succeed
    npm run build
  </verify>
  <done>
    Trip detail page shows trip information with edit and delete actions. Edit page uses TripForm with existing trip data. Delete button includes confirmation dialog before deletion.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete trip management system with authentication, database, API, and UI</what-built>
  <how-to-verify>
    NOTE: Before testing, you must complete user_setup:
    1. Create a Clerk application at https://dashboard.clerk.com
    2. Get CLERK_SECRET_KEY and NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
    3. Create a PostgreSQL database (Neon, Supabase, Railway, or local Docker)
    4. Get DATABASE_URL connection string
    5. Update .env.local with real values (remove SKIP_ENV_VALIDATION=true)
    6. Run: npm run db:push (creates tables)
    7. Run: npm run dev

    Then test the following flows:

    **Authentication (AUTH-01 to AUTH-04):**
    1. Visit http://localhost:3000 - should see landing page with Sign In / Sign Up buttons
    2. Click "Sign Up" - create account with email/password
    3. After signup, should redirect to /trips
    4. Refresh page - should stay logged in (session persists)
    5. Click avatar in top-right - should see logout option
    6. Click logout - should return to landing page
    7. Try to access http://localhost:3000/trips directly while logged out - should redirect to sign-in
    8. Sign in again - should work and redirect to /trips
    9. For password reset, use "Forgot password?" link on sign-in page (Clerk handles this)

    **Trip Management (TRIP-01 to TRIP-05):**
    1. Click "New Trip" button
    2. Create trip with name "Test Trip" and date range
    3. Should redirect to trips list, showing new trip
    4. Click on the trip card - should see trip detail page
    5. Click "Edit" - should see form with existing values
    6. Update the name, save - should see updated name on detail page
    7. Click "Delete" - should show confirmation
    8. Confirm delete - should redirect to trips list, trip gone
    9. Create another trip - verify it persists across page refresh
  </how-to-verify>
  <resume-signal>Type "approved" if all flows work, or describe any issues encountered</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds
2. Trip list displays all user trips with cards
3. New trip form creates trips successfully
4. Trip detail page shows trip information
5. Edit form updates trips correctly
6. Delete button removes trips with confirmation
7. All pages have proper auth checks and navigation
</verification>

<success_criteria>
- User can view list of their trips (TRIP-04)
- User can create a new trip with name and date range (TRIP-01)
- User can view individual trip details
- User can edit trip details (TRIP-02)
- User can delete trips with confirmation (TRIP-03)
- Trips persist to database (TRIP-05)
- All auth requirements verified through UI testing (AUTH-01 through AUTH-04)
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-infrastructure-authentication/01-05-SUMMARY.md`
</output>
